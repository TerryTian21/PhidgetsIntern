package LCDGraphing;

import com.phidget22.LCD;
import com.phidget22.LCDFont;
import com.phidget22.LCDPixelState;
import com.phidget22.TemperatureSensor;
import java.math.RoundingMode;
import java.text.DecimalFormat;


import java.util.ArrayList;

public class Main {
	
	static ArrayList<Double> temperature = new ArrayList<Double>();
	static ArrayList<Integer> pixelTemp = new ArrayList<Integer>();
	private static DecimalFormat df = new DecimalFormat("0.0");

	
	public static void main(String args[]) throws Exception{
		
		//Initializes Sensors
		LCD lcd = new LCD();
		lcd.open(1000);
		
		TemperatureSensor temperatureSensor = new TemperatureSensor();
		temperatureSensor.open(1000);
		
		
		//This initializes the graph axis
		
		lcd.drawLine(20, 0, 20, 54);
		lcd.drawLine(20, 54, 127, 54);
		
		lcd.flush();
		//Test generating data
		/*
		for(int i =0; i<20; i++) {
			
			temperature.add((Math.random() * (38-21) + 20));
			double pixel = 54 - 54*(double)(temperature.get(i)-20)/18;
			pixelTemp.add((int)pixel);
		}
		*/
		//Setting up some variables used to display graph
		int time = 1;
		int time1 = 1;
		Double temp;
		double scale;
		double maxTemp;
		double minTemp;
		
		System.out.println("Start");
		
		//Displays the graph on screen
		while(true) {
			
			lcd.drawRect(21, 0, 127, 53, true, true);
			
			//Rounds off temperature to nearest tenth
			temperature.add(temperatureSensor.getTemperature());
			
			if(temperature.size() > 10) {
			
				//This changes the values on the x-axis as time progresses
				for(int i =30; i<127; i+= 10){
					lcd.drawLine(i,52,i,54);
					lcd.writeText(LCDFont.DIMENSIONS_5X8, i-3, 56, Integer.toString(time));
					time++;
				}
				
				//Changes the y-axis based on the current data points (auto-scaling)
				maxTemp = getMax(time1);
				minTemp = getMin(time1);
				temp = maxTemp;
				System.out.println();
				scale = ((maxTemp-minTemp)/7);

				System.out.println(scale);
		
				for(int i =0; i<=54; i+= 9) {
					lcd.drawLine(20,i,22,i);
					lcd.writeText(LCDFont.DIMENSIONS_5X8, 0, i, Double.toString(Double.valueOf(df.format(temp))));
					temp -= scale;
				}
				
				lcd.flush();
				
				
				//Changes the pixel location of the temp based on min and max data points
				for(int i =0; i<10; i++) {
					
					
				}
				
				//Temp 2 gives the pixel for the first time data point
				int temp2 = 30;
				//Graphs data
				for(int i = 0; i<10; i++) {
					
					lcd.drawRect(temp2, pixelTemp.get(i + time1), temp2+1, pixelTemp.get(i + time1)+1, false, false);
					if(i >0)
						lcd.drawLine(temp2-10, pixelTemp.get(i + time1-1), temp2, pixelTemp.get(i+time1));
				
					temp2 += 10;
				
				}
				
				lcd.flush();
				Thread.sleep(500);
				
				//Changes the values on x-axis as time changes
				time1++;
				time = time1;;
			
			}
			
			Thread.sleep(350);
	
		}
		
		
		/*
		 * 
		 *Displays max and min temperature on screen
		int counter = 0;
		int max = temperature.get(counter);
		int min = temperature.get(counter);
		
		for(int i = counter; i < counter +10; i++) {
			
			if(temperature.get(i) > max)
				max = temperature.get(i);
			if(temperature.get(i) < min)
				min = temperature.get(i);
		}
		
		System.out.println("The max temp is: " + max);
		System.out.println("The min temp is: " + min);
		
		
		*/
		
	}
	
	public static double getMax(int counter) {
		
		double max = 0;
		
		for(int i = counter; i < counter +10; i++) {
					
			if(temperature.get(i) > max)
				max = temperature.get(i);
		}
		
		return max;
		
	}
	 
	public static double getMin(int counter) {
		
		double min = temperature.get(counter);
		
		return min;
	}

}
